# -*- coding: utf-8 -*-
"""app.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1FHSpQt7m8ke6ryf3QgTtbkuSzQrXXsQ5
"""

# app.py - ä¿¡ç”¨å¡è©æ¬ºåµæ¸¬äº’å‹•é é¢
import streamlit as st
import pandas as pd
import joblib

st.title("ğŸ’³ ä¿¡ç”¨å¡è©æ¬ºåµæ¸¬ Demo")
st.caption("æ¨¡å‹ï¼šLogistic Regressionï¼ˆclass_weight='balanced'ï¼‰ï¼Œè³‡æ–™ï¼šKaggle/ULBï¼Œåƒ…ä¾›æ•™è‚²ç”¨é€”")

# è¼‰å…¥è¨“ç·´å¥½çš„æ¨¡å‹
model = joblib.load('fraud_lr.pkl')

# èª¿æ•´é¢¨éšªé–€æª»
thr = st.slider("âš ï¸ é¢¨éšªé–€æª» (Threshold)", 0.01, 0.99, 0.5, 0.01)

# ä¸Šå‚³æª”æ¡ˆ
uploaded_file = st.file_uploader("ğŸ“‚ ä¸Šå‚³äº¤æ˜“ CSV æª”æ¡ˆï¼ˆTime, V1-V28, Amount æ¬„ä½ï¼‰", type=["csv"])

if uploaded_file is not None:
    # è®€å–æª”æ¡ˆ
    df = pd.read_csv(uploaded_file)
    st.write("è³‡æ–™ç­†æ•¸ï¼š", len(df))

    # é æ¸¬
    prob = model.predict_proba(df)[:, 1]  # è©æ¬ºæ©Ÿç‡
    pred = (prob >= thr).astype(int)       # æ ¹æ“šé–€æª»è½‰ç‚º 0/1

    # åˆä½µçµæœ
    out = df.copy()
    out["fraud_prob"] = prob
    out["prediction"] = pred

    # é¡¯ç¤ºå‰ 20 ç­†
    st.subheader("ğŸ” é æ¸¬çµæœï¼ˆå‰ 20 ç­†ï¼‰")
    st.write(out.head(20))

    # åŠ ä¸‹è¼‰æŒ‰éˆ•
    st.download_button(
        label="ğŸ’¾ ä¸‹è¼‰å®Œæ•´é æ¸¬çµæœ CSV",
        data=out.to_csv(index=False),
        file_name="predictions.csv",
        mime="text/csv"
    )